{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\NISHANTH MEGAN\\\\civiqai\\\\frontend\\\\public-portal\\\\src\\\\pages\\\\ReportPage.jsx\",\n  _s = $RefreshSig$();\nimport { useState, useRef, useEffect, useCallback } from 'react';\nimport axios from 'axios';\nimport ThinkingSteps from '../components/ThinkingSteps';\nimport { useTheme } from '../context/ThemeContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst BASE = process.env.REACT_APP_API_URL || 'http://localhost:8080';\n\n// Simulates the agent pipeline steps in real time\nfunction buildSteps(phase, hasImage) {\n  const imageSteps = [{\n    id: 'analyze',\n    label: 'Analyzing image with Gemini Vision',\n    detail: 'Identifying issue type, severity and road condition'\n  }, {\n    id: 'locate',\n    label: 'Geocoding location',\n    detail: 'Converting address to coordinates via Maps API'\n  }, {\n    id: 'ward',\n    label: 'Finding municipal ward',\n    detail: 'Reverse geocoding to get ward and zone'\n  }, {\n    id: 'search',\n    label: 'Searching municipal directory',\n    detail: 'Looking up responsible officer in Redis'\n  }, {\n    id: 'cluster',\n    label: 'Checking nearby complaints',\n    detail: 'Scanning 500m radius for similar issues'\n  }, {\n    id: 'dispatch',\n    label: 'Sending work order email',\n    detail: 'Dispatching to municipal department'\n  }, {\n    id: 'publish',\n    label: 'Publishing to public feed',\n    detail: 'Posting complaint on the portal'\n  }];\n  const chatSteps = [{\n    id: 'processing',\n    label: 'Processing your query',\n    detail: 'Understanding your question'\n  }, {\n    id: 'search',\n    label: 'Searching complaint database',\n    detail: 'Looking up relevant data'\n  }, {\n    id: 'analyze',\n    label: 'Analyzing trends and patterns',\n    detail: 'Generating insights'\n  }, {\n    id: 'respond',\n    label: 'Preparing response',\n    detail: 'Formatting answer for you'\n  }];\n  const all = hasImage ? imageSteps : chatSteps;\n  return all.map((s, i) => ({\n    ...s,\n    active: i <= phase,\n    status: i < phase ? 'done' : i === phase ? 'running' : 'analyzing'\n  }));\n}\nconst SUGGESTIONS = ['üöß Report a pothole', 'üíß Water pipe leaking', 'üóëÔ∏è Garbage not collected', 'üí° Streetlight not working', 'üåä Waterlogging issue'];\nexport default function ReportPage() {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [image, setImage] = useState(null);\n  const [preview, setPreview] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [phase, setPhase] = useState(-1);\n  const [started, setStarted] = useState(false);\n  const [hasImage, setHasImage] = useState(false);\n  const bottomRef = useRef(null);\n  const fileRef = useRef(null);\n  const timerRef = useRef(null);\n  const {\n    theme\n  } = useTheme();\n  const dark = theme === 'dark';\n  useEffect(() => {\n    var _bottomRef$current;\n    (_bottomRef$current = bottomRef.current) === null || _bottomRef$current === void 0 ? void 0 : _bottomRef$current.scrollIntoView({\n      behavior: 'smooth'\n    });\n  }, [messages, phase]);\n\n  // Handle paste event to capture images from clipboard\n  useEffect(() => {\n    const handlePaste = e => {\n      var _e$clipboardData;\n      const items = (_e$clipboardData = e.clipboardData) === null || _e$clipboardData === void 0 ? void 0 : _e$clipboardData.items;\n      if (!items) return;\n      for (const item of items) {\n        if (item.type.startsWith('image/')) {\n          e.preventDefault();\n          const file = item.getAsFile();\n          if (file) {\n            setImage(file);\n            setPreview(URL.createObjectURL(file));\n          }\n          break;\n        }\n      }\n    };\n    document.addEventListener('paste', handlePaste);\n    return () => document.removeEventListener('paste', handlePaste);\n  }, []);\n\n  // Simulate step-by-step agent progress\n  const simulateSteps = useCallback((onDone, isImageSubmission) => {\n    let step = 0;\n    const maxSteps = isImageSubmission ? 7 : 4;\n    setPhase(0);\n    timerRef.current = setInterval(() => {\n      step++;\n      if (step >= maxSteps) {\n        clearInterval(timerRef.current);\n        setPhase(maxSteps + 1); // all done\n        onDone();\n      } else {\n        setPhase(step);\n      }\n    }, 2800);\n  }, []);\n  const handleImage = e => {\n    const file = e.target.files[0];\n    if (!file) return;\n    setImage(file);\n    setPreview(URL.createObjectURL(file));\n  };\n  const handleRemoveImage = () => {\n    setImage(null);\n    setPreview(null);\n    if (fileRef.current) fileRef.current.value = '';\n  };\n  const handleSubmit = async text => {\n    const msg = text || input.trim();\n    if (!msg && !image) return;\n    const isImageSubmission = !!image;\n    setHasImage(isImageSubmission);\n    setStarted(true);\n    setLoading(true);\n    setPhase(0);\n\n    // Add user message\n    setMessages(prev => [...prev, {\n      role: 'user',\n      text: msg,\n      image: preview\n    }]);\n    setInput('');\n    setPreview(null);\n\n    // Add thinking message\n    const thinkingId = Date.now();\n    setMessages(prev => [...prev, {\n      role: 'thinking',\n      id: thinkingId\n    }]);\n\n    // Start API call immediately\n    const apiPromise = image ? submitWithImage(msg) : submitChatOnly(msg);\n\n    // Race: simulate steps, but resolve as soon as API responds\n    let apiDone = false;\n    let apiResult = null;\n    let apiError = null;\n\n    // Fire API and capture result\n    apiPromise.then(result => {\n      apiResult = result;\n    }).catch(err => {\n      apiError = err;\n    }).finally(() => {\n      apiDone = true;\n    });\n    const showResult = () => {\n      if (apiError) {\n        var _apiError, _apiError$response, _apiError$response$da, _apiError2, _apiError2$response, _apiError2$response$d;\n        const errorMessage = ((_apiError = apiError) === null || _apiError === void 0 ? void 0 : (_apiError$response = _apiError.response) === null || _apiError$response === void 0 ? void 0 : (_apiError$response$da = _apiError$response.data) === null || _apiError$response$da === void 0 ? void 0 : _apiError$response$da.reply) || ((_apiError2 = apiError) === null || _apiError2 === void 0 ? void 0 : (_apiError2$response = _apiError2.response) === null || _apiError2$response === void 0 ? void 0 : (_apiError2$response$d = _apiError2$response.data) === null || _apiError2$response$d === void 0 ? void 0 : _apiError2$response$d.message) || '‚ùå Something went wrong. Please try again.';\n        setMessages(prev => prev.map(m => m.id === thinkingId ? {\n          role: 'assistant',\n          text: errorMessage\n        } : m));\n      } else {\n        setMessages(prev => prev.map(m => m.id === thinkingId ? {\n          role: 'assistant',\n          text: apiResult || 'Done!'\n        } : m));\n      }\n      setLoading(false);\n      setPhase(-1);\n      setImage(null);\n      setHasImage(false);\n      setGpsCoords(null);\n    };\n\n    // Simulate steps; check each tick if API already responded\n    simulateSteps(() => {\n      // Steps animation done ‚Äî show result (API should be done by now)\n      if (apiDone) {\n        showResult();\n      } else {\n        // API still running ‚Äî wait for it\n        apiPromise.finally(() => showResult());\n      }\n    }, isImageSubmission);\n  };\n  const submitWithImage = async description => {\n    const fd = new FormData();\n    fd.append('image', image);\n    if (description) fd.append('location', description);\n    const {\n      data\n    } = await axios.post(`${BASE}/complaint`, fd, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n    return data.message || 'Complaint submitted successfully!';\n  };\n  const submitChatOnly = async msg => {\n    const {\n      data\n    } = await axios.post(`${BASE}/chat`, {\n      message: msg,\n      session_id: 'public_portal_chat'\n    }, {\n      timeout: 30000\n    });\n    return data.reply || data.message || 'Received your message.';\n  };\n\n  // Welcome screen\n  if (!started) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"max-w-2xl mx-auto px-3 sm:px-4 py-10 sm:py-16 flex flex-col\\r items-center text-center\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-12 h-12 sm:w-16 sm:h-16 rounded-2xl bg-gradient-to-br\\r from-blue-600 to-purple-600 flex items-center\\r justify-center text-2xl sm:text-3xl mb-4 sm:mb-6 shadow-lg\",\n      children: \"\\uD83C\\uDFD9\\uFE0F\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n      className: `text-2xl sm:text-3xl font-bold mb-2 ${dark ? 'text-white' : 'text-gray-900'}`,\n      children: \"Report a Civic Issue\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      className: `mb-6 sm:mb-10 max-w-md text-sm sm:text-base px-2 ${dark ? 'text-zinc-400' : 'text-gray-500'}`,\n      children: \"Take a photo or paste an image \\u2014 CiviqAI will extract the location from the image metadata, analyze it, and notify the right department.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-full max-w-xl\",\n      children: /*#__PURE__*/_jsxDEV(InputBar, {\n        input: input,\n        setInput: setInput,\n        image: image,\n        preview: preview,\n        fileRef: fileRef,\n        handleImage: handleImage,\n        handleRemoveImage: handleRemoveImage,\n        onSubmit: handleSubmit,\n        loading: loading,\n        dark: dark\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex flex-wrap gap-1.5 sm:gap-2 justify-center mt-4 sm:mt-6 px-1\",\n      children: SUGGESTIONS.map(s => /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => handleSubmit(s),\n        className: `px-3 sm:px-4 py-1.5 sm:py-2 border\n                       rounded-full text-xs sm:text-sm\n                       active:scale-95 transition-all\n                       ${dark ? 'bg-zinc-900 border-white/10 text-zinc-400 hover:border-white/30 hover:text-white' : 'bg-white border-gray-200 text-gray-600 hover:border-gray-400 hover:text-gray-900 shadow-sm'}`,\n        children: s\n      }, s, false, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 227,\n    columnNumber: 5\n  }, this);\n\n  // Chat view\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"max-w-2xl mx-auto px-3 sm:px-4 flex flex-col\\r h-[calc(100vh-57px)] sm:h-[calc(100vh-65px)]\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 overflow-y-auto py-4 sm:py-6 space-y-6 sm:space-y-8\",\n      children: [messages.map((m, i) => {\n        var _m$text, _m$text2;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [m.role === 'user' && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mb-4 sm:mb-6\",\n            children: [m.image && /*#__PURE__*/_jsxDEV(\"img\", {\n              src: m.image,\n              alt: \"uploaded\",\n              className: \"w-full max-h-40 sm:max-h-56 object-cover\\r rounded-xl sm:rounded-2xl mb-2 sm:mb-3 border border-white/10\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 291,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n              className: `text-lg sm:text-2xl font-bold leading-tight ${dark ? 'text-white' : 'text-gray-900'}`,\n              children: m.text\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 295,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 289,\n            columnNumber: 15\n          }, this), m.role === 'thinking' && phase >= 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `border rounded-2xl p-5\n                              ${dark ? 'bg-zinc-900 border-white/10' : 'bg-gray-50 border-gray-200'}`,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center gap-2 mb-4\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"w-4 h-4 border-2 border-zinc-600\\r border-t-blue-400 rounded-full animate-spin\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 306,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-sm font-medium text-zinc-400\",\n                children: hasImage ? 'CiviqAI is processing your complaint...' : 'CiviqAI is thinking...'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 308,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 305,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(ThinkingSteps, {\n              steps: buildSteps(phase, hasImage)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 312,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 15\n          }, this), m.role === 'assistant' && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"space-y-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center gap-2 mb-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"w-6 h-6 rounded-full bg-gradient-to-br\\r from-blue-500 to-purple-600 flex items-center\\r justify-center text-xs\",\n                children: \"\\uD83E\\uDD16\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 320,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-sm font-semibold text-white\",\n                children: \"CiviqAI\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 323,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 319,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `prose text-base leading-relaxed max-w-none\n                                ${dark ? 'prose-invert text-zinc-200' : 'text-gray-700'}`,\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                children: m.text\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 327,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 325,\n              columnNumber: 17\n            }, this), (_m$text = m.text) !== null && _m$text !== void 0 && _m$text.includes('submitted') || (_m$text2 = m.text) !== null && _m$text2 !== void 0 && _m$text2.includes('sent') ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"bg-green-500/10 border border-green-500/20\\r rounded-xl p-4 flex items-start gap-3\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-2xl\",\n                children: \"\\u2705\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 335,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-green-400 font-semibold text-sm\",\n                  children: \"Complaint Submitted\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 337,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-green-300/70 text-xs mt-0.5\",\n                  children: \"Your complaint is now live on the feed and the department has been notified.\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 340,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 336,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 333,\n              columnNumber: 19\n            }, this) : null]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 318,\n            columnNumber: 15\n          }, this)]\n        }, i, true, {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 11\n        }, this);\n      }), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: bottomRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `pb-4 pt-2 border-t ${dark ? 'border-white/10' : 'border-gray-200'}`,\n      children: /*#__PURE__*/_jsxDEV(InputBar, {\n        input: input,\n        setInput: setInput,\n        image: image,\n        preview: preview,\n        fileRef: fileRef,\n        handleImage: handleImage,\n        handleRemoveImage: handleRemoveImage,\n        onSubmit: handleSubmit,\n        loading: loading,\n        dark: dark\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 356,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 355,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 279,\n    columnNumber: 5\n  }, this);\n}\n\n// ‚îÄ‚îÄ Shared Input Bar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n_s(ReportPage, \"vVHBz4SU9sJP+4FX/BS3NEoh8Ho=\", false, function () {\n  return [useTheme];\n});\n_c = ReportPage;\nfunction InputBar({\n  input,\n  setInput,\n  image,\n  preview,\n  fileRef,\n  handleImage,\n  handleRemoveImage,\n  onSubmit,\n  loading,\n  onGps,\n  gpsLoading,\n  gpsCoords,\n  dark\n}) {\n  const handleKey = e => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      onSubmit(input);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `border rounded-2xl overflow-hidden transition-colors\n                    ${dark ? 'bg-zinc-900 border-white/10 focus-within:border-white/30' : 'bg-white border-gray-200 focus-within:border-gray-400 shadow-sm'}`,\n    children: [gpsCoords && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-4 pt-3 flex items-center gap-2\",\n      children: /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"inline-flex items-center gap-1.5 px-3 py-1\\r bg-blue-500/15 border border-blue-500/30\\r rounded-full text-xs text-blue-400\",\n        children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n          className: \"w-3.5 h-3.5\",\n          fill: \"currentColor\",\n          viewBox: \"0 0 24 24\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            d: \"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 010-5 2.5 2.5 0 010 5z\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 396,\n          columnNumber: 13\n        }, this), \"GPS: \", gpsCoords.lat.toFixed(4), \", \", gpsCoords.lng.toFixed(4)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 392,\n      columnNumber: 9\n    }, this), preview && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-4 pt-3\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative inline-block\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: preview,\n          alt: \"preview\",\n          className: \"h-20 w-32 object-cover rounded-xl\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 408,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleRemoveImage,\n          className: \"absolute -top-1 -right-1 w-5 h-5 bg-zinc-700\\r rounded-full flex items-center justify-center\\r text-xs hover:bg-red-600 transition-colors\",\n          children: \"\\u2715\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 410,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 407,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 406,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-end gap-2 px-4 py-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n        value: input,\n        onChange: e => setInput(e.target.value),\n        onKeyDown: handleKey,\n        placeholder: gpsCoords ? \"Location detected ‚Äî add description...\" : preview ? \"Add location or description...\" : \"Describe the issue or paste an image (Ctrl+V)...\",\n        rows: 1,\n        className: `flex-1 bg-transparent text-sm resize-none focus:outline-none\n                     max-h-32 overflow-y-auto\n                     ${dark ? 'text-white placeholder:text-zinc-600' : 'text-gray-900 placeholder:text-gray-400'}`,\n        style: {\n          fieldSizing: 'content'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 423,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-2 flex-shrink-0\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onGps,\n          disabled: gpsLoading,\n          className: `w-8 h-8 rounded-full flex items-center justify-center\n                       transition-colors ${gpsCoords ? 'text-blue-400 bg-blue-500/15' : 'text-zinc-500 hover:text-white hover:bg-white/10'}`,\n          title: \"Use my current location\",\n          children: gpsLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-4 h-4 border-2 border-zinc-600\\r border-t-blue-400 rounded-full animate-spin\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 450,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"w-5 h-5\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 1.5,\n              d: \"M12 2a7 7 0 00-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 00-7-7zm0 9.5a2.5 2.5 0 110-5 2.5 2.5 0 010 5z\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 454,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 452,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 440,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => fileRef.current.click(),\n          className: \"w-8 h-8 rounded-full flex items-center justify-center\\r text-zinc-500 hover:text-white hover:bg-white/10\\r transition-colors\",\n          title: \"Attach photo (or paste with Ctrl+V)\",\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"w-5 h-5\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 1.5,\n              d: \"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 471,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 469,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 462,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          ref: fileRef,\n          type: \"file\",\n          accept: \"image/*\",\n          className: \"hidden\",\n          onChange: handleImage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 476,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => onSubmit(input),\n          disabled: loading || !input.trim() && !image,\n          className: `w-8 h-8 rounded-full flex items-center\n                       justify-center disabled:opacity-30 disabled:cursor-not-allowed\n                       transition-colors\n                       ${dark ? 'bg-white hover:bg-zinc-200' : 'bg-slate-900 hover:bg-slate-800'}`,\n          children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `w-4 h-4 border-2 rounded-full animate-spin\n                                ${dark ? 'border-zinc-400 border-t-zinc-800' : 'border-gray-400 border-t-white'}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 489,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: `w-4 h-4 ${dark ? 'text-black' : 'text-white'}`,\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M5 12h14M12 5l7 7-7 7\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 493,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 491,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 480,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 437,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 422,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 386,\n    columnNumber: 5\n  }, this);\n}\n_c2 = InputBar;\nvar _c, _c2;\n$RefreshReg$(_c, \"ReportPage\");\n$RefreshReg$(_c2, \"InputBar\");","map":{"version":3,"names":["useState","useRef","useEffect","useCallback","axios","ThinkingSteps","useTheme","jsxDEV","_jsxDEV","BASE","process","env","REACT_APP_API_URL","buildSteps","phase","hasImage","imageSteps","id","label","detail","chatSteps","all","map","s","i","active","status","SUGGESTIONS","ReportPage","_s","messages","setMessages","input","setInput","image","setImage","preview","setPreview","loading","setLoading","setPhase","started","setStarted","setHasImage","bottomRef","fileRef","timerRef","theme","dark","_bottomRef$current","current","scrollIntoView","behavior","handlePaste","e","_e$clipboardData","items","clipboardData","item","type","startsWith","preventDefault","file","getAsFile","URL","createObjectURL","document","addEventListener","removeEventListener","simulateSteps","onDone","isImageSubmission","step","maxSteps","setInterval","clearInterval","handleImage","target","files","handleRemoveImage","value","handleSubmit","text","msg","trim","prev","role","thinkingId","Date","now","apiPromise","submitWithImage","submitChatOnly","apiDone","apiResult","apiError","then","result","catch","err","finally","showResult","_apiError","_apiError$response","_apiError$response$da","_apiError2","_apiError2$response","_apiError2$response$d","errorMessage","response","data","reply","message","m","setGpsCoords","description","fd","FormData","append","post","headers","session_id","timeout","className","children","fileName","_jsxFileName","lineNumber","columnNumber","InputBar","onSubmit","onClick","_m$text","_m$text2","src","alt","steps","includes","ref","_c","onGps","gpsLoading","gpsCoords","handleKey","key","shiftKey","fill","viewBox","d","lat","toFixed","lng","onChange","onKeyDown","placeholder","rows","style","fieldSizing","disabled","title","stroke","strokeLinecap","strokeLinejoin","strokeWidth","click","accept","_c2","$RefreshReg$"],"sources":["C:/Users/NISHANTH MEGAN/civiqai/frontend/public-portal/src/pages/ReportPage.jsx"],"sourcesContent":["import { useState, useRef, useEffect, useCallback } from 'react';\r\nimport axios from 'axios';\r\nimport ThinkingSteps from '../components/ThinkingSteps';\r\nimport { useTheme } from '../context/ThemeContext';\r\n\r\nconst BASE = process.env.REACT_APP_API_URL || 'http://localhost:8080';\r\n\r\n// Simulates the agent pipeline steps in real time\r\nfunction buildSteps(phase, hasImage) {\r\n  const imageSteps = [\r\n    { id: 'analyze',  label: 'Analyzing image with Gemini Vision',\r\n      detail: 'Identifying issue type, severity and road condition' },\r\n    { id: 'locate',   label: 'Geocoding location',\r\n      detail: 'Converting address to coordinates via Maps API' },\r\n    { id: 'ward',     label: 'Finding municipal ward',\r\n      detail: 'Reverse geocoding to get ward and zone' },\r\n    { id: 'search',   label: 'Searching municipal directory',\r\n      detail: 'Looking up responsible officer in Redis' },\r\n    { id: 'cluster',  label: 'Checking nearby complaints',\r\n      detail: 'Scanning 500m radius for similar issues' },\r\n    { id: 'dispatch', label: 'Sending work order email',\r\n      detail: 'Dispatching to municipal department' },\r\n    { id: 'publish',  label: 'Publishing to public feed',\r\n      detail: 'Posting complaint on the portal' },\r\n  ];\r\n\r\n  const chatSteps = [\r\n    { id: 'processing', label: 'Processing your query',\r\n      detail: 'Understanding your question' },\r\n    { id: 'search',   label: 'Searching complaint database',\r\n      detail: 'Looking up relevant data' },\r\n    { id: 'analyze',  label: 'Analyzing trends and patterns',\r\n      detail: 'Generating insights' },\r\n    { id: 'respond',  label: 'Preparing response',\r\n      detail: 'Formatting answer for you' },\r\n  ];\r\n\r\n  const all = hasImage ? imageSteps : chatSteps;\r\n\r\n  return all.map((s, i) => ({\r\n    ...s,\r\n    active: i <= phase,\r\n    status: i < phase  ? 'done'\r\n          : i === phase ? 'running'\r\n          : 'analyzing'\r\n  }));\r\n}\r\n\r\nconst SUGGESTIONS = [\r\n  'üöß Report a pothole',\r\n  'üíß Water pipe leaking',\r\n  'üóëÔ∏è Garbage not collected',\r\n  'üí° Streetlight not working',\r\n  'üåä Waterlogging issue',\r\n];\r\n\r\nexport default function ReportPage() {\r\n  const [messages, setMessages] = useState([]);\r\n  const [input,    setInput]    = useState('');\r\n  const [image,    setImage]    = useState(null);\r\n  const [preview,  setPreview]  = useState(null);\r\n  const [loading,  setLoading]  = useState(false);\r\n  const [phase,    setPhase]    = useState(-1);\r\n  const [started,  setStarted]  = useState(false);\r\n  const [hasImage, setHasImage] = useState(false);\r\n  const bottomRef  = useRef(null);\r\n  const fileRef    = useRef(null);\r\n  const timerRef   = useRef(null);\r\n  const { theme }  = useTheme();\r\n  const dark       = theme === 'dark';\r\n\r\n  useEffect(() => {\r\n    bottomRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages, phase]);\r\n\r\n  // Handle paste event to capture images from clipboard\r\n  useEffect(() => {\r\n    const handlePaste = (e) => {\r\n      const items = e.clipboardData?.items;\r\n      if (!items) return;\r\n\r\n      for (const item of items) {\r\n        if (item.type.startsWith('image/')) {\r\n          e.preventDefault();\r\n          const file = item.getAsFile();\r\n          if (file) {\r\n            setImage(file);\r\n            setPreview(URL.createObjectURL(file));\r\n          }\r\n          break;\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener('paste', handlePaste);\r\n    return () => document.removeEventListener('paste', handlePaste);\r\n  }, []);\r\n\r\n  // Simulate step-by-step agent progress\r\n  const simulateSteps = useCallback((onDone, isImageSubmission) => {\r\n    let step = 0;\r\n    const maxSteps = isImageSubmission ? 7 : 4;\r\n    setPhase(0);\r\n    timerRef.current = setInterval(() => {\r\n      step++;\r\n      if (step >= maxSteps) {\r\n        clearInterval(timerRef.current);\r\n        setPhase(maxSteps + 1); // all done\r\n        onDone();\r\n      } else {\r\n        setPhase(step);\r\n      }\r\n    }, 2800);\r\n  }, []);\r\n\r\n  const handleImage = (e) => {\r\n    const file = e.target.files[0];\r\n    if (!file) return;\r\n    setImage(file);\r\n    setPreview(URL.createObjectURL(file));\r\n  };\r\n\r\n  const handleRemoveImage = () => {\r\n    setImage(null);\r\n    setPreview(null);\r\n    if (fileRef.current) fileRef.current.value = '';\r\n  };\r\n\r\n  const handleSubmit = async (text) => {\r\n    const msg = text || input.trim();\r\n    if (!msg && !image) return;\r\n\r\n    const isImageSubmission = !!image;\r\n    setHasImage(isImageSubmission);\r\n    setStarted(true);\r\n    setLoading(true);\r\n    setPhase(0);\r\n\r\n    // Add user message\r\n    setMessages(prev => [...prev, {\r\n      role:    'user',\r\n      text:    msg,\r\n      image:   preview\r\n    }]);\r\n    setInput('');\r\n    setPreview(null);\r\n\r\n    // Add thinking message\r\n    const thinkingId = Date.now();\r\n    setMessages(prev => [...prev, {\r\n      role: 'thinking',\r\n      id:   thinkingId\r\n    }]);\r\n\r\n    // Start API call immediately\r\n    const apiPromise = image\r\n      ? submitWithImage(msg)\r\n      : submitChatOnly(msg);\r\n\r\n    // Race: simulate steps, but resolve as soon as API responds\r\n    let apiDone = false;\r\n    let apiResult = null;\r\n    let apiError = null;\r\n\r\n    // Fire API and capture result\r\n    apiPromise\r\n      .then(result => { apiResult = result; })\r\n      .catch(err => { apiError = err; })\r\n      .finally(() => { apiDone = true; });\r\n\r\n    const showResult = () => {\r\n      if (apiError) {\r\n        const errorMessage = apiError?.response?.data?.reply\r\n          || apiError?.response?.data?.message\r\n          || '‚ùå Something went wrong. Please try again.';\r\n        setMessages(prev => prev.map(m =>\r\n          m.id === thinkingId\r\n            ? { role: 'assistant', text: errorMessage }\r\n            : m\r\n        ));\r\n      } else {\r\n        setMessages(prev => prev.map(m =>\r\n          m.id === thinkingId\r\n            ? { role: 'assistant', text: apiResult || 'Done!' }\r\n            : m\r\n        ));\r\n      }\r\n      setLoading(false);\r\n      setPhase(-1);\r\n      setImage(null);\r\n      setHasImage(false);\r\n      setGpsCoords(null);\r\n    };\r\n\r\n    // Simulate steps; check each tick if API already responded\r\n    simulateSteps(() => {\r\n      // Steps animation done ‚Äî show result (API should be done by now)\r\n      if (apiDone) {\r\n        showResult();\r\n      } else {\r\n        // API still running ‚Äî wait for it\r\n        apiPromise.finally(() => showResult());\r\n      }\r\n    }, isImageSubmission);\r\n  };\r\n\r\n  const submitWithImage = async (description) => {\r\n    const fd = new FormData();\r\n    fd.append('image', image);\r\n    if (description) fd.append('location', description);\r\n    const { data } = await axios.post(`${BASE}/complaint`, fd, {\r\n      headers: { 'Content-Type': 'multipart/form-data' }\r\n    });\r\n    return data.message || 'Complaint submitted successfully!';\r\n  };\r\n\r\n  const submitChatOnly = async (msg) => {\r\n    const { data } = await axios.post(`${BASE}/chat`, {\r\n      message: msg,\r\n      session_id: 'public_portal_chat'\r\n    }, { timeout: 30000 });\r\n    return data.reply || data.message || 'Received your message.';\r\n  };\r\n\r\n  // Welcome screen\r\n  if (!started) return (\r\n    <div className=\"max-w-2xl mx-auto px-3 sm:px-4 py-10 sm:py-16 flex flex-col\r\n                    items-center text-center\">\r\n      <div className=\"w-12 h-12 sm:w-16 sm:h-16 rounded-2xl bg-gradient-to-br\r\n                      from-blue-600 to-purple-600 flex items-center\r\n                      justify-center text-2xl sm:text-3xl mb-4 sm:mb-6 shadow-lg\">\r\n        üèôÔ∏è\r\n      </div>\r\n      <h1 className={`text-2xl sm:text-3xl font-bold mb-2 ${dark ? 'text-white' : 'text-gray-900'}`}>\r\n        Report a Civic Issue\r\n      </h1>\r\n      <p className={`mb-6 sm:mb-10 max-w-md text-sm sm:text-base px-2 ${dark ? 'text-zinc-400' : 'text-gray-500'}`}>\r\n        Take a photo or paste an image ‚Äî CiviqAI will extract the location\r\n        from the image metadata, analyze it, and notify the right department.\r\n      </p>\r\n\r\n      {/* Main input */}\r\n      <div className=\"w-full max-w-xl\">\r\n        <InputBar\r\n          input={input}\r\n          setInput={setInput}\r\n          image={image}\r\n          preview={preview}\r\n          fileRef={fileRef}\r\n          handleImage={handleImage}\r\n          handleRemoveImage={handleRemoveImage}\r\n          onSubmit={handleSubmit}\r\n          loading={loading}\r\n          dark={dark}\r\n        />\r\n      </div>\r\n\r\n      {/* Suggestions */}\r\n      <div className=\"flex flex-wrap gap-1.5 sm:gap-2 justify-center mt-4 sm:mt-6 px-1\">\r\n        {SUGGESTIONS.map(s => (\r\n          <button\r\n            key={s}\r\n            onClick={() => handleSubmit(s)}\r\n            className={`px-3 sm:px-4 py-1.5 sm:py-2 border\r\n                       rounded-full text-xs sm:text-sm\r\n                       active:scale-95 transition-all\r\n                       ${dark ? 'bg-zinc-900 border-white/10 text-zinc-400 hover:border-white/30 hover:text-white'\r\n                              : 'bg-white border-gray-200 text-gray-600 hover:border-gray-400 hover:text-gray-900 shadow-sm'}`}\r\n          >\r\n            {s}\r\n          </button>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  // Chat view\r\n  return (\r\n    <div className=\"max-w-2xl mx-auto px-3 sm:px-4 flex flex-col\r\n                    h-[calc(100vh-57px)] sm:h-[calc(100vh-65px)]\">\r\n\r\n      {/* Messages */}\r\n      <div className=\"flex-1 overflow-y-auto py-4 sm:py-6 space-y-6 sm:space-y-8\">\r\n        {messages.map((m, i) => (\r\n          <div key={i}>\r\n\r\n            {/* User message */}\r\n            {m.role === 'user' && (\r\n              <div className=\"mb-4 sm:mb-6\">\r\n                {m.image && (\r\n                  <img src={m.image} alt=\"uploaded\"\r\n                       className=\"w-full max-h-40 sm:max-h-56 object-cover\r\n                                  rounded-xl sm:rounded-2xl mb-2 sm:mb-3 border border-white/10\"/>\r\n                )}\r\n                <h2 className={`text-lg sm:text-2xl font-bold leading-tight ${dark ? 'text-white' : 'text-gray-900'}`}>\r\n                  {m.text}\r\n                </h2>\r\n              </div>\r\n            )}\r\n\r\n            {/* Thinking / Processing */}\r\n            {m.role === 'thinking' && phase >= 0 && (\r\n              <div className={`border rounded-2xl p-5\r\n                              ${dark ? 'bg-zinc-900 border-white/10' : 'bg-gray-50 border-gray-200'}`}>\r\n                <div className=\"flex items-center gap-2 mb-4\">\r\n                  <div className=\"w-4 h-4 border-2 border-zinc-600\r\n                                  border-t-blue-400 rounded-full animate-spin\"/>\r\n                  <span className=\"text-sm font-medium text-zinc-400\">\r\n                    {hasImage ? 'CiviqAI is processing your complaint...' : 'CiviqAI is thinking...'}\r\n                  </span>\r\n                </div>\r\n                <ThinkingSteps steps={buildSteps(phase, hasImage)} />\r\n              </div>\r\n            )}\r\n\r\n            {/* Assistant response */}\r\n            {m.role === 'assistant' && (\r\n              <div className=\"space-y-3\">\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  <div className=\"w-6 h-6 rounded-full bg-gradient-to-br\r\n                                  from-blue-500 to-purple-600 flex items-center\r\n                                  justify-center text-xs\">ü§ñ</div>\r\n                  <span className=\"text-sm font-semibold text-white\">CiviqAI</span>\r\n                </div>\r\n                <div className={`prose text-base leading-relaxed max-w-none\r\n                                ${dark ? 'prose-invert text-zinc-200' : 'text-gray-700'}`}>\r\n                  <p>{m.text}</p>\r\n                </div>\r\n\r\n                {/* Success card */}\r\n                {m.text?.includes('submitted') ||\r\n                 m.text?.includes('sent') ? (\r\n                  <div className=\"bg-green-500/10 border border-green-500/20\r\n                                  rounded-xl p-4 flex items-start gap-3\">\r\n                    <span className=\"text-2xl\">‚úÖ</span>\r\n                    <div>\r\n                      <p className=\"text-green-400 font-semibold text-sm\">\r\n                        Complaint Submitted\r\n                      </p>\r\n                      <p className=\"text-green-300/70 text-xs mt-0.5\">\r\n                        Your complaint is now live on the feed and the\r\n                        department has been notified.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                ) : null}\r\n              </div>\r\n            )}\r\n          </div>\r\n        ))}\r\n        <div ref={bottomRef} />\r\n      </div>\r\n\r\n      {/* Sticky input */}\r\n      <div className={`pb-4 pt-2 border-t ${dark ? 'border-white/10' : 'border-gray-200'}`}>\r\n        <InputBar\r\n          input={input}\r\n          setInput={setInput}\r\n          image={image}\r\n          preview={preview}\r\n          fileRef={fileRef}\r\n          handleImage={handleImage}\r\n          handleRemoveImage={handleRemoveImage}\r\n          onSubmit={handleSubmit}\r\n          loading={loading}\r\n          dark={dark}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ‚îÄ‚îÄ Shared Input Bar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\r\nfunction InputBar({ input, setInput, image, preview, fileRef,\r\n                    handleImage, handleRemoveImage, onSubmit, loading,\r\n                    onGps, gpsLoading, gpsCoords, dark }) {\r\n\r\n  const handleKey = (e) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      onSubmit(input);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`border rounded-2xl overflow-hidden transition-colors\r\n                    ${dark ? 'bg-zinc-900 border-white/10 focus-within:border-white/30'\r\n                           : 'bg-white border-gray-200 focus-within:border-gray-400 shadow-sm'}`}>\r\n\r\n      {/* GPS location badge */}\r\n      {gpsCoords && (\r\n        <div className=\"px-4 pt-3 flex items-center gap-2\">\r\n          <span className=\"inline-flex items-center gap-1.5 px-3 py-1\r\n                           bg-blue-500/15 border border-blue-500/30\r\n                           rounded-full text-xs text-blue-400\">\r\n            <svg className=\"w-3.5 h-3.5\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 010-5 2.5 2.5 0 010 5z\"/>\r\n            </svg>\r\n            GPS: {gpsCoords.lat.toFixed(4)}, {gpsCoords.lng.toFixed(4)}\r\n          </span>\r\n        </div>\r\n      )}\r\n\r\n      {/* Image preview strip */}\r\n      {preview && (\r\n        <div className=\"px-4 pt-3\">\r\n          <div className=\"relative inline-block\">\r\n            <img src={preview} alt=\"preview\"\r\n                 className=\"h-20 w-32 object-cover rounded-xl\"/>\r\n            <button\r\n              onClick={handleRemoveImage}\r\n              className=\"absolute -top-1 -right-1 w-5 h-5 bg-zinc-700\r\n                         rounded-full flex items-center justify-center\r\n                         text-xs hover:bg-red-600 transition-colors\">\r\n              ‚úï\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Text input */}\r\n      <div className=\"flex items-end gap-2 px-4 py-3\">\r\n        <textarea\r\n          value={input}\r\n          onChange={e => setInput(e.target.value)}\r\n          onKeyDown={handleKey}\r\n          placeholder={gpsCoords ? \"Location detected ‚Äî add description...\" : preview ? \"Add location or description...\" : \"Describe the issue or paste an image (Ctrl+V)...\"}\r\n          rows={1}\r\n          className={`flex-1 bg-transparent text-sm resize-none focus:outline-none\r\n                     max-h-32 overflow-y-auto\r\n                     ${dark ? 'text-white placeholder:text-zinc-600'\r\n                            : 'text-gray-900 placeholder:text-gray-400'}`}\r\n          style={{ fieldSizing: 'content' }}\r\n        />\r\n\r\n        {/* Action buttons */}\r\n        <div className=\"flex items-center gap-2 flex-shrink-0\">\r\n\r\n          {/* GPS location */}\r\n          <button\r\n            onClick={onGps}\r\n            disabled={gpsLoading}\r\n            className={`w-8 h-8 rounded-full flex items-center justify-center\r\n                       transition-colors ${gpsCoords\r\n                         ? 'text-blue-400 bg-blue-500/15'\r\n                         : 'text-zinc-500 hover:text-white hover:bg-white/10'}`}\r\n            title=\"Use my current location\"\r\n          >\r\n            {gpsLoading\r\n              ? <div className=\"w-4 h-4 border-2 border-zinc-600\r\n                                border-t-blue-400 rounded-full animate-spin\"/>\r\n              : <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\"\r\n                     viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\"\r\n                        strokeWidth={1.5}\r\n                        d=\"M12 2a7 7 0 00-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 00-7-7zm0 9.5a2.5 2.5 0 110-5 2.5 2.5 0 010 5z\"/>\r\n                </svg>\r\n            }\r\n          </button>\r\n\r\n          {/* Attach photo */}\r\n          <button\r\n            onClick={() => fileRef.current.click()}\r\n            className=\"w-8 h-8 rounded-full flex items-center justify-center\r\n                       text-zinc-500 hover:text-white hover:bg-white/10\r\n                       transition-colors\"\r\n            title=\"Attach photo (or paste with Ctrl+V)\"\r\n          >\r\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\"\r\n                 viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\"\r\n                    strokeWidth={1.5}\r\n                    d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\"/>\r\n            </svg>\r\n          </button>\r\n          <input ref={fileRef} type=\"file\" accept=\"image/*\"\r\n                 className=\"hidden\" onChange={handleImage} />\r\n\r\n          {/* Submit */}\r\n          <button\r\n            onClick={() => onSubmit(input)}\r\n            disabled={loading || (!input.trim() && !image)}\r\n            className={`w-8 h-8 rounded-full flex items-center\r\n                       justify-center disabled:opacity-30 disabled:cursor-not-allowed\r\n                       transition-colors\r\n                       ${dark ? 'bg-white hover:bg-zinc-200' : 'bg-slate-900 hover:bg-slate-800'}`}\r\n          >\r\n            {loading\r\n              ? <div className={`w-4 h-4 border-2 rounded-full animate-spin\r\n                                ${dark ? 'border-zinc-400 border-t-zinc-800' : 'border-gray-400 border-t-white'}`}/>\r\n              : <svg className={`w-4 h-4 ${dark ? 'text-black' : 'text-white'}`} fill=\"none\"\r\n                     stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\"\r\n                        strokeWidth={2} d=\"M5 12h14M12 5l7 7-7 7\"/>\r\n                </svg>\r\n            }\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}